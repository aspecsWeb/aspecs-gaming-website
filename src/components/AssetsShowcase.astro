---
import Container from "../layouts/Container.astro";

const apiKey = import.meta.env.ITCHIO_KEY;
  if (!apiKey)
    throw new Error("ItchIO API Key is missing");

    const fetchAssets = async () => {
  try {
    const response = await fetch(`https://itch.io/api/1/${apiKey}/my-games`);
    const data = await response.json();
    return data.games;
  } catch (error) {
    console.error('Error fetching assets:', error);
    return [];
  }
};

interface Asset {
  title: string;
  cover_url: string;
  short_text: string;
  url: string;
  published: boolean;
}

const assets: Asset[] = await fetchAssets();
---

<Container size="xl">
  <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {assets.map(asset => (
      asset.published && (
        <a href={asset.url} class="block p-4 border rounded-lg shadow-md no-underline">
          <article>
            <h2 class="text-2xl font-semibold mb-2">{asset.title}</h2>
            <img src={asset.cover_url} alt={`Cover for ${asset.title}`} class="mb-2 object-cover rounded-lg"/>
            <p class="text-base">{asset.short_text}</p>
          </article>
        </a>
      )
    ))}
  </main>
</Container>